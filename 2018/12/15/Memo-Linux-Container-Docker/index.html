<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Docker | Kuangcp Blog | Javaer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="基础">
    <meta name="description" content="目录 start  Docker 简介 个人理解 学习资源   安装与卸载 Linux 安装包安装 Ubuntu Debian Centos Arch   不加sudo执行docker命令   Windows   初步使用 镜像仓库 搭建本地仓库   基础命令 镜像命令 容器命令 create run exec commit port   端口映射   数据卷 数据卷容器   Dockerfile">
<meta name="keywords" content="基础">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/index.html">
<meta property="og:site_name" content="Kuangcp Blog">
<meta property="og:description" content="目录 start  Docker 简介 个人理解 学习资源   安装与卸载 Linux 安装包安装 Ubuntu Debian Centos Arch   不加sudo执行docker命令   Windows   初步使用 镜像仓库 搭建本地仓库   基础命令 镜像命令 容器命令 create run exec commit port   端口映射   数据卷 数据卷容器   Dockerfile">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-12-16T09:11:25.585Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker">
<meta name="twitter:description" content="目录 start  Docker 简介 个人理解 学习资源   安装与卸载 Linux 安装包安装 Ubuntu Debian Centos Arch   不加sudo执行docker命令   Windows   初步使用 镜像仓库 搭建本地仓库   基础命令 镜像命令 容器命令 create run exec commit port   端口映射   数据卷 数据卷容器   Dockerfile">
    
        <link rel="alternate" type="application/atom+xml" title="Kuangcp Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Kuangcp</h5>
          <a href="mailto:kuangcp@aliyun.com" title="kuangcp@aliyun.com" class="mail">kuangcp@aliyun.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories">
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/kuangcp" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Docker</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Docker</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-12-15T03:24:44.000Z" itemprop="datePublished" class="page-time">
  2018-12-15
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Docker/">Docker</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Docker"><span class="post-toc-number">1.</span> <span class="post-toc-text">Docker</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#个人理解"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">个人理解</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#学习资源"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">学习资源</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#安装与卸载"><span class="post-toc-number">2.</span> <span class="post-toc-text">安装与卸载</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Linux"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">Linux</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装包安装"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">安装包安装</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Ubuntu"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">Ubuntu</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Debian"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">Debian</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Centos"><span class="post-toc-number">2.1.3.1.</span> <span class="post-toc-text">Centos</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Arch"><span class="post-toc-number">2.1.3.2.</span> <span class="post-toc-text">Arch</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#不加sudo执行docker命令"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">不加sudo执行docker命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Windows"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">Windows</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#初步使用"><span class="post-toc-number">3.</span> <span class="post-toc-text">初步使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#镜像仓库"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">镜像仓库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#搭建本地仓库"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">搭建本地仓库</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基础命令"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">基础命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#镜像命令"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">镜像命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#容器命令"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">容器命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#create"><span class="post-toc-number">3.4.1.</span> <span class="post-toc-text">create</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#run"><span class="post-toc-number">3.4.2.</span> <span class="post-toc-text">run</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#exec"><span class="post-toc-number">3.4.3.</span> <span class="post-toc-text">exec</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#commit"><span class="post-toc-number">3.4.4.</span> <span class="post-toc-text">commit</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#port"><span class="post-toc-number">3.4.5.</span> <span class="post-toc-text">port</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#端口映射"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">端口映射</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据卷"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据卷</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据卷容器"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">数据卷容器</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Dockerfile"><span class="post-toc-number">5.</span> <span class="post-toc-text">Dockerfile</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#dockerignore文件的使用"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">dockerignore文件的使用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用启动脚本和多进程容器"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">使用启动脚本和多进程容器</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#容器编排"><span class="post-toc-number">6.</span> <span class="post-toc-text">容器编排</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Docker-Compose"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">Docker-Compose</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装"><span class="post-toc-number">6.1.1.</span> <span class="post-toc-text">安装</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Docker-Machine"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">Docker-Machine</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Docker-Swarm"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">Docker-Swarm</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#网络"><span class="post-toc-number">7.</span> <span class="post-toc-text">网络</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#None"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">None</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Host"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">Host</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Bridge"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">Bridge</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#User-defined"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">User-defined</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#跨主机容器通信"><span class="post-toc-number">7.5.</span> <span class="post-toc-text">跨主机容器通信</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#overlay"><span class="post-toc-number">7.5.1.</span> <span class="post-toc-text">overlay</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-Memo-Linux-Container-Docker" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Docker</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-12-15 11:24:44" datetime="2018-12-15T03:24:44.000Z" itemprop="datePublished">2018-12-15</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Docker/">Docker</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p><strong>目录 start</strong></p>
<ol>
<li><a href="#docker">Docker</a><ol>
<li><a href="#简介">简介</a></li>
<li><a href="#个人理解">个人理解</a></li>
<li><a href="#学习资源">学习资源</a></li>
</ol>
</li>
<li><a href="#安装与卸载">安装与卸载</a><ol>
<li><a href="#linux">Linux</a><ol>
<li><a href="#安装包安装">安装包安装</a></li>
<li><a href="#ubuntu">Ubuntu</a></li>
<li><a href="#debian">Debian</a><ol>
<li><a href="#centos">Centos</a></li>
<li><a href="#arch">Arch</a></li>
</ol>
</li>
<li><a href="#不加sudo执行docker命令">不加sudo执行docker命令</a></li>
</ol>
</li>
<li><a href="#windows">Windows</a></li>
</ol>
</li>
<li><a href="#初步使用">初步使用</a><ol>
<li><a href="#镜像仓库">镜像仓库</a><ol>
<li><a href="#搭建本地仓库">搭建本地仓库</a></li>
</ol>
</li>
<li><a href="#基础命令">基础命令</a></li>
<li><a href="#镜像命令">镜像命令</a></li>
<li><a href="#容器命令">容器命令</a><ol>
<li><a href="#create">create</a></li>
<li><a href="#run">run</a></li>
<li><a href="#exec">exec</a></li>
<li><a href="#commit">commit</a></li>
<li><a href="#port">port</a></li>
</ol>
</li>
<li><a href="#端口映射">端口映射</a></li>
</ol>
</li>
<li><a href="#数据卷">数据卷</a><ol>
<li><a href="#数据卷容器">数据卷容器</a></li>
</ol>
</li>
<li><a href="#dockerfile">Dockerfile</a><ol>
<li><a href="#dockerignore文件的使用">dockerignore文件的使用</a></li>
<li><a href="#使用启动脚本和多进程容器">使用启动脚本和多进程容器</a></li>
</ol>
</li>
<li><a href="#容器编排">容器编排</a><ol>
<li><a href="#docker-compose">Docker-Compose</a><ol>
<li><a href="#安装">安装</a></li>
</ol>
</li>
<li><a href="#docker-machine">Docker-Machine</a></li>
<li><a href="#docker-swarm">Docker-Swarm</a></li>
</ol>
</li>
<li><a href="#网络">网络</a><ol>
<li><a href="#none">None</a></li>
<li><a href="#host">Host</a></li>
<li><a href="#bridge">Bridge</a></li>
<li><a href="#user-defined">User-defined</a></li>
<li><a href="#跨主机容器通信">跨主机容器通信</a><ol>
<li><a href="#overlay">overlay</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>目录 end</strong>|<em>2018-12-13 12:06</em>| <a href="https://gitee.com/gin9" target="_blank" rel="noopener">码云</a> | <a href="http://blog.csdn.net/kcp606" target="_blank" rel="noopener">CSDN</a> | <a href="https://my.oschina.net/kcp1104" target="_blank" rel="noopener">OSChina</a> | <a href="http://www.cnblogs.com/kuangcp" target="_blank" rel="noopener">cnblogs</a></p>
<hr>
<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><blockquote>
<p><a href="https://docs.docker.com/" target="_blank" rel="noopener">Official Doc</a> | <a href="www.docker-cn.com">docker-cn</a><code>Docker中国</code></p>
</blockquote>
<ul>
<li><p><a href="http://www.docker.org.cn/" target="_blank" rel="noopener">docker中文</a><code>社区</code></p>
</li>
<li><p><a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="noopener">Gitbook: docker 从入门到实践</a></p>
</li>
</ul>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li><code>Docker 是一个开源的应用容器引擎</code> 理解为加强版虚拟机</li>
<li>让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。</li>
</ul>
<h2 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h2><ul>
<li>docker中的容器是动态的，随时创建和销毁，只有镜像是持久化的</li>
<li>而且容器是一个虚拟出来的功能完备的Linux操作系统可以进行登录运行命令</li>
<li><code>docker images</code>来得到所有的本地镜像名<ul>
<li>使用<code>docker run --name {name} -d {image-name}</code>新命名一个容器来启动某个镜像</li>
<li>然后<code>docker ps</code>查看容器运行状况</li>
</ul>
</li>
<li>镜像的命名：<ul>
<li>如果要push到仓库就要遵循这个规范，本地用就无所谓了，而且以后也可以取新的名字 <code>docker tag 原名 新名</code> </li>
<li>官方的hub： <code>用户名/镜像名：tag</code></li>
<li>非官方的例如阿里 <code>registry.cn-hangzhou.aliyuncs.com/myth/jdk8:alpine</code> jdk8是镜像名，前面的是仓库地址</li>
</ul>
</li>
</ul>
<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2><ul>
<li><a href="https://labs.play-with-docker.com/" target="_blank" rel="noopener">PMD: player with docker</a><code>啥都不说了, 直接干</code></li>
</ul>
<blockquote>
<p><a href="https://gitee.com/explore/starred?lang=Docker" target="_blank" rel="noopener">码云上Docke相关资源</a></p>
</blockquote>
<ul>
<li><a href="https://gitee.com/dockerf/docker-training" target="_blank" rel="noopener">docker-training 开源项目</a><ul>
<li><a href="https://gitee.com/dockerf/second" target="_blank" rel="noopener">第二课</a></li>
</ul>
</li>
<li><a href="https://gitee.com/kennylee/docker" target="_blank" rel="noopener">Dockerfile集锦</a></li>
<li><p><a href="https://github.com/oracle/docker-images" target="_blank" rel="noopener">Oracle的Dockerfile仓库</a></p>
</li>
<li><p><a href="http://blog.csdn.net/Raptor/article/details/18305299" target="_blank" rel="noopener"> 具有中国特色的docker折腾记（上）</a></p>
<ul>
<li><a href="http://blog.csdn.net/raptor/article/details/18405569" target="_blank" rel="noopener"> 具有中国特色的docker折腾记（下）</a></li>
</ul>
</li>
</ul>
<blockquote>
<p><a href="http://www.open-open.com/lib/view/open1443075440623.html" target="_blank" rel="noopener">docker资源汇总 </a><br><a href="http://www.importnew.com/24658.html" target="_blank" rel="noopener">简述 Docker</a></p>
</blockquote>
<ul>
<li style="list-style: none"><input type="checkbox"> todo <a href="https://docs.docker.com/develop/develop-images/multistage-build/" target="_blank" rel="noopener">Use multi-stage builds</a> <code>17.05+</code></li>
</ul>
<hr>
<h1 id="安装与卸载"><a href="#安装与卸载" class="headerlink" title="安装与卸载"></a>安装与卸载</h1><blockquote>
<p><a href="http://get.daocloud.io/#install-docker" target="_blank" rel="noopener">daocloud安装帮助</a> | <a href="http://guide.daocloud.io/dcs/daocloud-9153151.html" target="_blank" rel="noopener">Docker 加速器</a></p>
</blockquote>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><blockquote>
<p><a href="https://docs.docker.com/install/linux/docker-ce/" target="_blank" rel="noopener">Official doc</a> <code>所有的发行版</code></p>
</blockquote>
<blockquote>
<p>docker.io 是旧版本 现在新的Docker分为 docker-ce  docker-ee</p>
</blockquote>
<h3 id="安装包安装"><a href="#安装包安装" class="headerlink" title="安装包安装"></a>安装包安装</h3><blockquote>
<p><a href="https://download.docker.com/linux/" target="_blank" rel="noopener">官方文件地址</a></p>
</blockquote>
<p><em>Debian系</em></p>
<ul>
<li><a href="https://download.docker.com/linux/debian/dists/" target="_blank" rel="noopener">deb包选择</a></li>
<li>进去后选择debain的版本，deepin15.4 的版本是stretch 然后pool/stable/amd64/选版本即可 </li>
<li>例如：<a href="https://download.docker.com/linux/debian/dists/stretch/pool/stable/amd64/" target="_blank" rel="noopener">Deepin 15.4直接点这里</a></li>
<li><code>这两种方式装的是同一个版本号</code> </li>
<li>双击或者<code>sudo dpkg -i deb文件</code></li>
<li>测试安装成功 <code>sudo docker run hello-world</code></li>
</ul>
<h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><ul>
<li><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-docker-ce-1" target="_blank" rel="noopener">Official: Ubuntu安装最新版</a></li>
<li><code>sudo apt install docker-ce</code><ul>
<li>关闭服务则是标准服务操作, service docker stop </li>
</ul>
</li>
</ul>
<p><code>snap</code></p>
<ul>
<li>安装snap <code>sudo apt install snapd</code></li>
<li>查看适用于当前系统的包：<code>snap install find</code></li>
<li>安装： <code>snap install docker</code><h3 id="Debian"><a href="#Debian" class="headerlink" title="Debian"></a>Debian</h3><blockquote>
<p><a href="http://www.docker.org.cn/book/install/install-docker-on-debian-8.0-jessie-34.html" target="_blank" rel="noopener">参考</a></p>
</blockquote>
</li>
<li><code>sudo echo &quot;deb http://http.debian.net/debian jessie-backports main&quot; &gt;&gt; /etc/apt/sources.list</code></li>
<li><code>sudo apt-get install docker-ce</code></li>
</ul>
<ol>
<li><code>前置软件</code> sudo apt-get install \<br>  apt-transport-https \<br>  ca-certificates \<br>  curl \<br>  gnupg2 \<br>  lsb-release \<br>  software-properties-common</li>
</ol>
<blockquote>
<p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/" target="_blank" rel="noopener">使用清华大学镜像源安装</a></p>
</blockquote>
<blockquote>
<p>使用阿里云镜像源</p>
<ol>
<li>curl -fsSL <a href="https://mirrors.aliyun.com/docker-ce/linux/debian/gpg" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-ce/linux/debian/gpg</a> | sudo apt-key add -</li>
<li>sudo add-apt-repository \<br> “deb [arch=amd64] <a href="https://mirrors.aliyun.com/docker-ce/linux/debian" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-ce/linux/debian</a> \<br> $(lsb_release -cs) stable”</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>特别注意 <code>lsb_release -cs</code> 命令的执行结果, 本应该获取到的是发行代号 jessie stretch 等等, 但是Deepin15.8执行结果是 unstable …</li>
<li>所以要手动添加 或修改为 jessie <code>deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/debian jessie stable</code></li>
</ol>
</blockquote>
<hr>
<blockquote>
<p>使用官方源</p>
<ol>
<li>curl -fsSL <a href="https://download.docker.com/linux/debian/gpg" target="_blank" rel="noopener">https://download.docker.com/linux/debian/gpg</a> | sudo apt-key add -</li>
<li>sudo add-apt-repository \<br>“deb [arch=amd64] <a href="https://download.docker.com/linux/debian" target="_blank" rel="noopener">https://download.docker.com/linux/debian</a> \<br> $(lsb_release -cs) stable”</li>
</ol>
</blockquote>
<h4 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h4><ul>
<li><code>sudo yum install docker</code><ul>
<li>Ubuntu的话,Docker没有启动, 只要一执行Docker相关命令就会自动启动, 但是Centos要手动启动</li>
<li><code>service docker start</code>  设置开机启动: <code>chkconfig docker on</code></li>
</ul>
</li>
</ul>
<h4 id="Arch"><a href="#Arch" class="headerlink" title="Arch"></a>Arch</h4><ul>
<li><code>pacman -S docker</code></li>
</ul>
<h3 id="不加sudo执行docker命令"><a href="#不加sudo执行docker命令" class="headerlink" title="不加sudo执行docker命令"></a>不加sudo执行docker命令</h3><blockquote>
<p><a href="https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li>如果没有docker组，添加组 <code>sudo groupadd docker</code></li>
<li>将当前用户加入用户组 <code>sudo gpasswd -a $USER docker</code></li>
<li>然后重新注销登录，或者退出会话重新登录即可</li>
</ul>
<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><blockquote>
<p>Windows上本质是用了VirtualBox创建虚拟机来跑Docker, 屎一般的体验, 然而Win10的WSL因为不能模拟aufs 以及 cgroup 所以能装不能用<br>只能装上docker for windows 然后把Docker守护进程的套接字文件配置给wsl用。。。。。</p>
</blockquote>
<ul>
<li><a href="http://www.cnblogs.com/linjj/p/5606687.html" target="_blank" rel="noopener">参考博客</a></li>
<li><a href="https://www.docker.com/products/docker-toolbox" target="_blank" rel="noopener">官方toolbox 下载</a></li>
<li>然后双击安装，勾选上virtualbox 记住cpu要开虚拟化</li>
<li>安装完成后就会有三个图标在桌面上，然后进入Docker Quickstart Terminal后 <code>docker run hello-world</code> 有正常输出即可</li>
</ul>
<hr>
<h1 id="初步使用"><a href="#初步使用" class="headerlink" title="初步使用"></a>初步使用</h1><blockquote>
<p>docker 所有的数据默认存储在 <code>/var/lib/docker</code></p>
</blockquote>
<h2 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h2><blockquote>
<p>默认的DockerHub因为在国外所以网络不太稳定</p>
</blockquote>
<blockquote>
<p>Docker中国</p>
<ul>
<li><a href="https://www.docker-cn.com/registry-mirror" target="_blank" rel="noopener">Official doc</a></li>
</ul>
</blockquote>
<p><code>三种使用的方式</code></p>
<ol>
<li>使用指定的URL <code>docker pull registry.docker-cn.com/myname/myrepo:mytag</code></li>
<li>仅仅配置当前守护进程, 重启就失效了<code>docker --registry-mirror=https://registry.docker-cn.com daemon</code></li>
<li>修改 <code>/etc/docker/daemon.json</code>文件, 永久性更改<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"registry-mirrors"</span>: [<span class="string">"https://registry.docker-cn.com"</span>]&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>时速云</p>
<ul>
<li><code>sudo docker pull index.tenxcloud.com/&lt;namespace&gt;/&lt;repository&gt;:&lt;tag&gt;</code></li>
<li>下载后可以用别名 <code>docker tag index.tenxcloud.com/docker_library/node:lastest node:lastest</code></li>
<li>然后为了控制台干净可以直接将原来的长命名tag直接删除</li>
</ul>
</blockquote>
<blockquote>
<p>阿里云</p>
<ul>
<li><a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener">开发者平台</a></li>
<li>配置命名空间，仓库，然后使用文档的配置即可</li>
</ul>
</blockquote>
<blockquote>
<p>百度云</p>
<ul>
<li>个人较为推荐使用  | <a href="https://cloud.baidu.com/doc/CCE/GettingStarted.html#.E9.95.9C.E5.83.8F.E4.BB.93.E5.BA.93" target="_blank" rel="noopener">官方文档</a></li>
</ul>
</blockquote>
<ol>
<li><p>登录百度云镜像仓库</p>
<ul>
<li>sudo docker login –username=[username] hub.baidubce.com</li>
<li>username:镜像仓库名称，即是<code>开通镜像仓库时填写的用户名</code>。输入密码后完成登录。</li>
</ul>
</li>
<li><p>上传镜像</p>
<ul>
<li>sudo docker tag [ImageId] hub.baidubce.com/[namespace]/[ImageName]:[镜像版本号]  </li>
<li>sudo docker push hub.baidubce.com/[namespace]/[ImageName]:[镜像版本号]  <ul>
<li>ImageId和镜像版本号根据镜像信息补充  </li>
<li>namespace是开通镜像仓库时填写的命名空间  </li>
<li>ImageName是在控制台创建的镜像名称  </li>
</ul>
</li>
</ul>
</li>
<li><p>下载镜像</p>
<ul>
<li>登录到镜像仓库，需输入密码  </li>
<li>sudo docker pull hub.baidubce.com/[namespace]/[ImageName]:[镜像版本号]  </li>
</ul>
</li>
<li><p>使用加速器</p>
<ul>
<li>docker软件源地址：<a href="https://mirror.baidubce.com" target="_blank" rel="noopener">https://mirror.baidubce.com</a></li>
</ul>
</li>
</ol>
<hr>
<h3 id="搭建本地仓库"><a href="#搭建本地仓库" class="headerlink" title="搭建本地仓库"></a>搭建本地仓库</h3><blockquote>
<p><a href="https://docs.docker.com/registry/#requirements" target="_blank" rel="noopener">Official doc</a></p>
</blockquote>
<blockquote>
<p><a href="https://www.csdn.net/article/2015-09-09/2825651" target="_blank" rel="noopener">参考：Docker Registry V1 与 V2 的区别解析以及灵雀云的实时同步迁移实践</a></p>
</blockquote>
<blockquote>
<p><a href="https://github.com/docker/docker-registry" target="_blank" rel="noopener">Github:v1</a> | <a href="https://github.com/docker/distribution" target="_blank" rel="noopener">Github:v2</a></p>
</blockquote>
<blockquote>
<p>v1</p>
<ul>
<li>服务器上运行 并映射到本地目录 <code>docker run -d -p 5000:5000 -v /opt/data/registry:/tmp/registry registry</code></li>
<li>对服务器中docker已经有的镜像 设置别名 <code>docker tag 镜像 ip:port/镜像名</code></li>
<li>docker push ip:port/镜像名</li>
<li>查看服务器上仓库的镜像 <code>curl http://IP:5000/v1/search</code></li>
</ul>
</blockquote>
<blockquote>
<p>v2</p>
<ul>
<li>启动镜像 <code>docker run -d -p 5000:5000 --name registry registry:2</code> </li>
<li>一样的设置好别名， 然后push上去</li>
<li>查看仓库中的镜像 <code>curl IP:5000/v2/_catalog</code></li>
</ul>
</blockquote>
<blockquote>
<p><strong>注意</strong> 由于 docker client 默认是用的 HTTPS 方式通信， 但是这个本地的 registry 默认是 HTTP 的， 所以有几种解决方案</p>
</blockquote>
<ol>
<li>直接将本地仓库的IP和端口 设置为本地Docker的白名单<ul>
<li>给dockerd 添加参数 <code>DOCKER_OPTS=&quot;--insecure-registry ip:port&quot;</code></li>
<li>或者配置 /etc/docker/daemon.json  <code>{ &quot;insecure-registries&quot;:[&quot;IP:PORT&quot;] }</code></li>
<li>重启Docker服务</li>
</ul>
</li>
<li>配置 registry 为 HTTPS， 那么就需要配置SSL证书， 使用本地证书或者公网证书</li>
</ol>
<hr>
<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><blockquote>
<p>直接运行 docker, 就会有命令的使用提示 例如查看docker版本 <code>docker version</code></p>
</blockquote>
<p><em>登录镜像仓库</em></p>
<ul>
<li>登录hub.docker ：<code>docker login</code> 或者 <code>docker login -u username -p password</code></li>
<li>登录时速云：<code>sudo docker login index.tenxcloud.com</code></li>
<li>登录百度云： <code>docker login --username=[username] hub.baidubce.com</code></li>
</ul>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><ul>
<li>查看所有 ： <code>docker images</code><ul>
<li>docker images -a 查看所有镜像(包括中间镜像)</li>
</ul>
</li>
<li>搜索 ： <code>docker search 镜像名</code></li>
<li>安装 ： <code>docker pull 镜像名</code></li>
<li>删除 ： <code>docker rmi 镜像名</code></li>
<li>查看详细： <code>docker inspect [-f .Architesture]</code>  -f 查看JSON格式的具体节点的数据值</li>
<li>查看历史：<code>docker history imagename</code></li>
<li>添加标签（别名）： <code>docker tag originname newname</code></li>
<li>导出镜像文件：<code>docker save -o ubuntu.tar  ubuntu:14.04</code><ul>
<li>导入镜像文件： <code>docker load --input ubuntu.tar</code> 或 <code>docker load &lt; ubuntu.tar</code></li>
</ul>
</li>
<li>上传镜像： <code>docker push mythos/test:lastest</code></li>
</ul>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p>_ps_</p>
<ul>
<li>查看当前运行的容器：<code>docker ps</code><ul>
<li>查看所有容器 ：<code>docker ps -a</code></li>
<li>查看占用 :<code>docker ps -s</code></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/ps/#formatting" target="_blank" rel="noopener">ps formatting</a></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.ID 	    Container ID</span><br><span class="line">.Image 	    Image ID</span><br><span class="line">.Command 	Quoted command</span><br><span class="line">.CreatedAt 	Time when the container was created.</span><br><span class="line">.RunningFor Elapsed time since the container was started.</span><br><span class="line">.Ports 	    Exposed ports.</span><br><span class="line">.Status 	Container status.</span><br><span class="line">.Size 	    Container disk size.</span><br><span class="line">.Names 	    Container names.</span><br><span class="line">.Labels 	All labels assigned to the container.</span><br><span class="line">.Label 	    Value of a specific label for this container. For example &apos;&#123;&#123;.Label &quot;com.docker.swarm.cpu&quot;&#125;&#125;&apos;</span><br><span class="line">.Mounts 	Names of the volumes mounted in this container.</span><br><span class="line">.Networks 	Names of the networks attached to this container.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>查看所有容器的状态：<code>docker stats</code> 能看到正在运行的容器内存 cpu io net等信息</p>
<ul>
<li><code>-a</code> 所有容器</li>
<li><code>--no-stream</code> 不阻塞标准输出流，只输出一次信息</li>
</ul>
</li>
<li><p>停止容器：<code>docker stop 容器name</code></p>
</li>
<li>重启容器：<code>docker restart 容器name</code></li>
<li><p>启动容器：<code>docker start 容器name</code></p>
<ul>
<li>-i 交互模式，也可以进入终端</li>
</ul>
</li>
<li><p>删除容器：<code>docker rm 容器name</code></p>
<ul>
<li><code>-f</code> 强行停止正在运行的容器并删除 </li>
<li><code>-l</code> 删除容器的连接，但是保留容器</li>
<li><code>-v</code> 删除容器挂载的数据卷</li>
<li>删除所有容器：<code>docker rm ${docker -a -q}</code></li>
<li>删除所有容器和挂载的目录：<code>docker system prune --volumes -f</code></li>
</ul>
</li>
<li>容器日志(终端所有输入输出)：<code>docker logs 容器name或id</code></li>
<li><p>重命名 ： <code>docker rename origin new</code></p>
</li>
<li><p>导入导出 （容器快照）：</p>
<ul>
<li>导出： <code>docker export -o test.tar 容器名</code> <code>docker export 容器name &gt; test.tar</code></li>
<li>导入： <code>docker import [-c |--change=[]] [-m | --message=[]] file|URL - [repository]:[tag]</code></li>
<li>-c | –change=[] 选项在导入的同时执行对容器就行修改的Dockerfile指令。</li>
</ul>
</li>
</ul>
<h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><blockquote>
<p><a href="https://docs.docker.com/engine/reference/commandline/create" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><blockquote>
<p><a href="http://www.open-open.com/lib/view/open1422492851548.html" target="_blank" rel="noopener">Docker run 命令的使用方法</a><br>等价于 docker create 再 docker start</p>
</blockquote>
<ul>
<li><code>docker run -d --name conrainer-name image-name touch a.md</code> ，如果镜像本地没有会自动pull<ul>
<li><code>--name</code> 配置容器名字</li>
<li><code>-d</code> 后台启动程序</li>
<li><code>-i</code> 交互模式运行容器(标准输入和标准输出) <code>docker run  -it ubuntu /bin/bash</code></li>
<li><code>-t</code> 容器启动后进入其命令行</li>
<li><code>-v</code> 将本地文件夹建立映射到容器内 <code>-v 本机:容器</code></li>
<li><code>-p</code> 端口映射左本机右容器：<code>-p 44:22</code>主机容器端口相同就：<code>-p 22</code> 将容器所有EXPOSE的端口映射到宿主机随机端口<code>-P</code></li>
<li><code>-f</code> 文件？</li>
<li><code>--env name=&quot;tanky&quot;</code> 设置环境变量</li>
<li><code>--memory</code> 限制最大内存</li>
<li><code>--cpu-shares</code> 设置CPU的相对权重，只在link之间容器的权重比例</li>
<li><code>--cpuset-cpus</code> 限制只能运行在某标号的CPU上</li>
<li><code>--user</code> -u 限制用户</li>
<li><code>--cap-drop</code> 去除能力</li>
<li><code>--link</code> 链接其他容器</li>
<li><code>--rm</code> 容器运行结束退出就自动删除该容器 注意和<code>-d</code>不能共存</li>
<li><code>--restart=always</code> 设置该容器随dokcer 服务自启动</li>
<li><code>--hostname 容器hostname</code> 指定容器的hostname</li>
</ul>
</li>
</ul>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><ul>
<li>登录容器：<ul>
<li><code>docker exec -it 容器name或id bash</code></li>
<li><code>docker attach 容器id</code> 这个命令虽然简单，但是退出会话就自动关闭了容器</li>
</ul>
</li>
<li><p>这些选项不加就是默认值，加上短参数形式就是设为另一个值 如 -t</p>
<ul>
<li><code>-i</code>，<code>--interactive=ture|false</code> 打开标准输入接受用户输入命令</li>
<li><code>--privileged=true|false</code> 是否给以最高权限</li>
<li><code>-t</code>，<code>--tty=true|false</code> 是否分配伪终端</li>
<li><code>-u</code>，<code>--user=&quot;&quot;</code> 执行命令的用户或ID</li>
</ul>
</li>
<li><p>使用 nsenter 连接到容器:</p>
<ul>
<li>PID=${docker-pid 容器id}</li>
<li>nsenter –target $PID –mount –uts –ipc –net –pid</li>
</ul>
</li>
</ul>
<h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><ul>
<li><code>docker commit 容器id 镜像name</code> 将容器为id的当前容器 保存为name镜像</li>
</ul>
<h3 id="port"><a href="#port" class="headerlink" title="port"></a>port</h3><blockquote>
<p>查看容器的端口映射情况， 输出是左容器右本机， 和使用相反</p>
</blockquote>
<hr>
<h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><ul>
<li>当不指定对应的参数容器默认不开放任何端口给外部，可以使用 <code>-P</code> 或 <code>-p</code> 参数来开放<ul>
<li>-P 随机映射一个 49000-49900 的端口到容器开放的端口</li>
<li>-p  <code>IP:HostPort:ContainerPort | IP::ContainerPort | HostPort:ContainerPort</code><ul>
<li>映射到指定IP的指定端口<code>IP:HostPort:ContainerPort</code> </li>
<li>映射到指定IP的任意端口<code>IP::ContainerPort</code></li>
<li>映射到所有接口的地址的指定端口<code>HostPort:ContainerPort</code></li>
</ul>
</li>
<li>还可以使用 udp来标记为udp类型 <code>docker run -d -p 127.0.0.1::5000/udp ubuntu apt update</code></li>
</ul>
</li>
<li>查看端口<ul>
<li>查看容器内5000对应的外端口 <code>docker port ubuntu17 5000</code></li>
<li>查看容器的具体信息 <code>docker inspect 容器id</code> </li>
</ul>
</li>
</ul>
<hr>
<h1 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h1><blockquote>
<p><a href="http://www.open-open.com/lib/view/open1403571027233.html" target="_blank" rel="noopener">Docker 中管理数据</a><br><a href="http://www.open-open.com/lib/view/open1421996521062.html" target="_blank" rel="noopener">参考博客: 给一个正在运行的Docker容器动态添加Volume</a></p>
</blockquote>
<ul>
<li><p>数据卷是一个可供容器使用的特殊目录，它将宿主机操作系统目录映射进容器 类似于 mount操作</p>
<ul>
<li>数据卷可以在容器之间共享重用</li>
<li>数据卷内数据的修改会立马生效，无论是容器内操作还是本地操作</li>
<li>对数据卷的更新不会影响镜像，解耦了应用和数据</li>
<li>卷会一直存在，直到没有容器使用，才可以安全的卸载</li>
</ul>
</li>
<li><p><code>docker run -v dir:dir[:ro]</code> 一般是创建容器时使用，和-p类似可以多个，左本机右容器 默认rw权限可以指定 ro只读</p>
<ul>
<li>可以将一个文件挂载为数据卷，但是文件夹更好，文件可能会有问题出现</li>
</ul>
</li>
</ul>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><ul>
<li><code>docker run -it -v /test --name data ubuntu</code> 运行一个挂载了数据卷的容器</li>
<li>引用数据卷容器 来挂载数据卷：<code>docker run -it --volumes-from data --name db1 ubuntu</code></li>
<li>从已经挂载了数据卷容器的容器 来挂载数据卷：<code>docker run -it --volumes-from db1 --name db2 ubuntu</code></li>
<li>使用 <code>--volumes-from</code> 参数所挂载数据卷的容器并不需要保持在运行状态</li>
<li>如果删除了挂载的容器，数据卷并不会自动删除，而是要在删除最后一个容器时 使用 <code>docker rm -v</code> 来声明删除容器并删除关联的数据卷</li>
</ul>
<p><code>利用数据卷容器来迁移数据</code></p>
<ul>
<li>备份：<ul>
<li><code>docker run --volumes-from data -v $(pwd):/backup --name worker ubuntu tar cvf /backup/backup.tar /data</code></li>
<li>先基于Ubuntu创建一个worker容器并引用了数据卷容器data，然后将当前目录作为数据卷挂载进去，并执行tar命令，打包到数据卷容器的目录下</li>
<li>实现了将当前目录归档到数据卷容器下</li>
</ul>
</li>
<li>恢复：<ul>
<li>创建一个带有数据卷的容器（目标容器）<code>docker run -v /data --name reuse ubuntu /bin/bash</code></li>
<li>解压当前目录的tar文件到数据卷容器中 <code>docker run --volumes-from reuse -v $(pwd):/backup busybox tar xvf /backup/backup.tar</code></li>
<li>这个就是实现了将本地的归档数据放到指定的容器内，如果要从数据卷容器中恢复到别的容器就只要挂载对应的数据卷容器然后进目录直接解压即可</li>
</ul>
</li>
</ul>
<hr>
<h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><blockquote>
<p><a href="/Linux/Container/DockerFile.md">Dockerfile文件学习</a></p>
</blockquote>
<h2 id="dockerignore文件的使用"><a href="#dockerignore文件的使用" class="headerlink" title="dockerignore文件的使用"></a>dockerignore文件的使用</h2><ul>
<li>.dockerignore文件是依据 Go的PathMatch规范来的，使用和.gitignore类似</li>
</ul>
<h2 id="使用启动脚本和多进程容器"><a href="#使用启动脚本和多进程容器" class="headerlink" title="使用启动脚本和多进程容器"></a>使用启动脚本和多进程容器</h2><hr>
<h1 id="容器编排"><a href="#容器编排" class="headerlink" title="容器编排"></a>容器编排</h1><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h2><blockquote>
<p>声明式环境，管理多容器， 并处理好相关资源的关系</p>
</blockquote>
<p>案例 <a href="https://github.com/fecshop/yii2_fecshop_docker/blob/master/docker-compose.yml" target="_blank" rel="noopener">1</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote>
<p>sudo pip install -U docker-compose</p>
</blockquote>
<hr>
<h2 id="Docker-Machine"><a href="#Docker-Machine" class="headerlink" title="Docker-Machine"></a>Docker-Machine</h2><blockquote>
<p>创建一个docker集群环境 <a href="https://docs.docker.com/machine/install-machine" target="_blank" rel="noopener">官方文档安装</a></p>
</blockquote>
<p>Error with pre-create check: “VBoxManage not found. Make sure VirtualBox is installed and VBoxManage is in the path<br>Error with pre-create check: “This computer doesn’t have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory”</p>
<h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker-Swarm"></a>Docker-Swarm</h2><hr>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><blockquote>
<p><a href="https://docs.docker.com/network/" target="_blank" rel="noopener">Official Doc</a> 分为 none host brige user-defined 几种类型</p>
</blockquote>
<h2 id="None"><a href="#None" class="headerlink" title="None"></a>None</h2><blockquote>
<p>docker run -it –network none  busybox</p>
</blockquote>
<ul>
<li>不联网的容器, ifconfig 可以看到只有 lo </li>
</ul>
<h2 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h2><blockquote>
<p>docker run -it –network host busybox</p>
</blockquote>
<ul>
<li>采用宿主机的网络, 也就是说和宿主机使用同一个网络环境, hostname都是host的<ol>
<li>特点是性能, 但是不够灵活, 要考虑和host上的端口冲突问题</li>
<li>直接配置host的网络: 例如配置防火墙容器</li>
</ol>
</li>
</ul>
<h2 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h2><blockquote>
<p>安装 Docker 的时候, 都会创建一个 docker0 的网桥 Linux bridge</p>
</blockquote>
<ul>
<li>如果没有指定 <code>--network</code> 或者使用 <code>--network default</code> 创建容器 都会默认挂载到 docker0 上</li>
<li>通过 <code>docker network inspect bridge</code> 命令可以看到子网掩码是 <code>172.17.0.0/16</code> 网关是 172.17.0.1 <ul>
<li>也就是说能容纳 2的16次幂 -2 个容器 (65534), 容器创建时会依次分配ip</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意: 此方式下容器之间是互通的, 通常使用的 <code>--link containerName:aliasName</code> 也只不过是在 /etc/hosts 文件中添加了容器的 dns 而已</p>
</blockquote>
<ul>
<li style="list-style: none"><input type="checkbox"> 验证</li>
</ul>
<blockquote>
<p>特别容易出现锁，一个没有启动，其他的都启动不了 尝试？ <code>sudo service docker restart</code></p>
</blockquote>
<ul>
<li>例如: <code>创建一个MySQL容器供一个Ubuntu容器使用</code></li>
</ul>
<ol>
<li>创建MySQL容器 <code>docker run --name mysql2 -e MYSQL_ROOT_PASSWORD=ad -d mysql</code></li>
<li>创建Ubuntu容器 <code>docker run -d --name test --link mysql2:db ubuntu</code><ul>
<li>link参数说明 ：<code>--link name:alias</code> 在父容器中会将该映射加入host文件，所以无需找ip，直接使用别名</li>
</ul>
</li>
<li>docker会连接两个容器，而不用通过暴露端口来实现，web容器的host文件以及环境变量都会追加上mysql2的配置</li>
<li>所以在Ubuntu容器中连接MySQL容器， <code>mysql -h db -u root -pad</code> 即可连接上mysql<ul>
<li>如需看IP就 <code>cat /etc/hosts</code> 中myslq容器别名为db值的IP地址 </li>
<li>或者直接 <code>ping db</code> <code>apt install  inetutils-ping</code> <code>ifconfig就要安装net-tools</code></li>
</ul>
</li>
</ol>
<ul>
<li>例如：<code>创建一个Nginx和一个Springboot搭建的web服务</code><ul>
<li>构建Springboot应用镜像，构建应用容器 开放8888端口</li>
<li>新建nginx容器：<code>docker run --name youhuigo -d -p 80:80 -v /home/kuang/nginx/conf/:/etc/nginx/conf.d/:ro --link you:web nginx</code></li>
</ul>
</li>
<li>配置文件：<code>一样的cat /etc/hosts 查看容器的IP</code>， 其实最简单就是用link配置时的别名即可，因为Docker已经帮我们配置好了host。。。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">upstream youhui &#123;</span><br><span class="line">  server 172.17.0.4:8888;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name youhui;</span><br><span class="line"></span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Nginx-Proxt true;</span><br><span class="line"></span><br><span class="line">    proxy_pass http://youhui;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><a href="https://www.weave.works/" target="_blank" rel="noopener">weave</a> <code>能解决跨宿主机的容器互联问题</code></p>
</blockquote>
<h2 id="User-defined"><a href="#User-defined" class="headerlink" title="User-defined"></a>User-defined</h2><blockquote>
<p>Docker 提供三种 网络驱动 bridge overlay macvlan, 后两者可用于跨主机的容器通信</p>
</blockquote>
<h2 id="跨主机容器通信"><a href="#跨主机容器通信" class="headerlink" title="跨主机容器通信"></a>跨主机容器通信</h2><h3 id="overlay"><a href="#overlay" class="headerlink" title="overlay"></a>overlay</h3><blockquote>
<p><a href="http://dockone.io/article/2717" target="_blank" rel="noopener">参考博客: DOCKER的内置OVERLAY网络</a></p>
</blockquote>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-12-16T09:11:25.585Z" itemprop="dateUpdated">2018-12-16 17:11:25</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2018/12/15/Memo-Linux-Container-Docker/" target="_blank" rel="external">http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/</a>
        
    </div>
    
    <footer>
        <a href="http://blog.kuangcp.top">
            <img src="/img/avatar.jpg" alt="Kuangcp">
            Kuangcp
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/基础/">基础</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&title=《Docker》 — Kuangcp Blog&pic=http://blog.kuangcp.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&title=《Docker》 — Kuangcp Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Docker》 — Kuangcp Blog&url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&via=http://blog.kuangcp.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/12/15/Memo-Linux-Container-DockerAdvance/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Docker进阶</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/12/15/Memo-Linux-Centos-CentosBase/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Centos</h4>
      </a>
    </div>
  
</nav>



    

















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.png" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Kuangcp &copy; 2015 - 2018</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">赣ICP备17014189号-1</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&title=《Docker》 — Kuangcp Blog&pic=http://blog.kuangcp.top/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&title=《Docker》 — Kuangcp Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Docker》 — Kuangcp Blog&url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/&via=http://blog.kuangcp.top" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.kuangcp.top/2018/12/15/Memo-Linux-Container-Docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACwUlEQVR42u3aQW4jMQwEQP//05vrAkEm3aSUOEDNyYjHsmsOItPU6xVf//67Pv89/9RX93+1cvLZAxceHh7e4qd/vhLe8/35u8nDqlfAw8PDu8ZLlmu38ue/PxeA58KQFxg8PDy8d+C123fb6+aFBw8PD++v8NrIYFMqfq3u4eHh4QW8JD54DgUScLvOj2YteHh4eJOk9NU2yr/1+sp8Dw8PD289VT8VE+Qr598VrYmHh4d3gZdvuPlwK2/N90e+ojvx8PDwjvJmsLaEJIVkVja+CXPx8PDwrvHawVLbQCel5WwU8ho+Dzw8PLw0Bc3b5ZbXNtlJackHb3h4eHj3eMm2PjuGNQttk6NUqyMCeHh4eEd5+VY+29w3wXFScqL18fDw8Ba8WcSQPIKcnYcU+XetEhQ8PDy8gNdu8ZuS0Aa1s9KFh4eHd4+3aWefebMWPAlwZ48DDw8P7ywvaV5PffFsuLV56Hh4eHg3eLPBfL41zwrDbMBW9Ox4eHh4C14Szs7++c/vbx9Wnbjg4eHhHeK1w/h8484D33qslY/H8PDw8C7wksFV0tpufspmIBe1+Hh4eHhHeZtNOR9itYUnb6mj6BYPDw/vKG+TeSYb/alMIB/FHYt08fDw8B7DiM1ov32W0fYdP7hvDijg4eHhXeDdWLod9j9v/cm7bVOOh4eHt+e1xWA2jsojj6ScFMUGDw8P7xqv3Zrz4f1mc8+p0XwPDw8P7xpv0y4ngezmyEIeYeDh4eHd4G0CgnzElTTr+RGEYtiGh4eHd4E3G0TNgt322EHSfL9OXXh4eHglry0G7esWk4caUQuOh4eHd42XN77J1tzGuO36xXEHPDw8vLfh1WlxWUiOfRYPDw/vDXjtEajNMGx/sAAPDw/vHm929Goz0MpjkVXEjIeHh3eBN2uO20/Vx0w3RwHw8PDwbvE+AE48xTpDYrmdAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
